<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/admin :: layout(~{::content})}">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
</head>
<body>
<div th:fragment="content">
  <h2 class="mb-4">ğŸ“Š Tá»•ng quan há»‡ thá»‘ng</h2>
  <div class="row text-center mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-primary text-white">
        <div class="card-body">
          <h5 class="card-title">ğŸ‘¥ Tá»•ng tÃ i khoáº£n</h5>
          <h2 th:text="${totalAccounts ?: 0}">0</h2>
          <small>Táº¥t cáº£ tÃ i khoáº£n trong há»‡ thá»‘ng</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-success text-white">
        <div class="card-body">
          <h5 class="card-title">ğŸ‘¤ NgÆ°á»i dÃ¹ng</h5>
          <h2 th:text="${totalUsers ?: 0}">0</h2>
          <small>TÃ i khoáº£n USER</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-warning text-white">
        <div class="card-body">
          <h5 class="card-title">ğŸ‘¨â€ğŸ’¼ Quáº£n lÃ½</h5>
          <h2 th:text="${totalManagers ?: 0}">0</h2>
          <small>TÃ i khoáº£n MANAGER</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-danger text-white">
        <div class="card-body">
          <h5 class="card-title">ğŸ‘‘ Quáº£n trá»‹</h5>
          <h2 th:text="${totalAdmins ?: 0}">0</h2>
          <small>TÃ i khoáº£n ADMIN</small>
        </div>
      </div>
    </div>
  </div>
  <div class="row text-center mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-info text-white">
        <div class="card-body">
          <h5 class="card-title">ğŸŸï¸ SÃ¢n hoáº¡t Ä‘á»™ng</h5>
          <h2 th:text="${totalFields ?: 0}">0</h2>
          <small>SÃ¢n Ä‘ang má»Ÿ</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-secondary text-white">
        <div class="card-body">
          <h5 class="card-title">ğŸ¢ Tá»•ng dá»‹ch vá»¥</h5>
          <h2 th:text="${totalServices ?: 0}">0</h2>
          <small>Táº¥t cáº£ dá»‹ch vá»¥</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-success text-white">
        <div class="card-body">
          <h5 class="card-title">âœ… TK hoáº¡t Ä‘á»™ng</h5>
          <h2 th:text="${activeAccounts ?: 0}">0</h2>
          <small>TÃ i khoáº£n Ä‘ang hoáº¡t Ä‘á»™ng</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-dark text-white">
        <div class="card-body">
          <h5 class="card-title">âŒ TK bá»‹ khÃ³a</h5>
          <h2 th:text="${inactiveAccounts ?: 0}">0</h2>
          <small>TÃ i khoáº£n bá»‹ vÃ´ hiá»‡u hÃ³a</small>
        </div>
      </div>
    </div>
  </div>
  <!-- Section to display active users -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title">ğŸ‘¥ NgÆ°á»i dÃ¹ng Ä‘ang online <span id="connectionStatus" class="badge bg-danger">Disconnected</span></h5>
          <ul id="activeUsersList" class="list-group"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize WebSocket connection
    const socket = new SockJS('/ws');
    const stompClient = Stomp.over(socket);

    // Connect to WebSocket (no username needed for admin dashboard)
    stompClient.connect({}, function (frame) {
      console.log('Connected: ' + frame);
      document.getElementById('connectionStatus').textContent = 'Connected';
      document.getElementById('connectionStatus').className = 'badge bg-success';

      // Subscribe to /topic/activeUsers
      stompClient.subscribe('/topic/activeUsers', function (message) {
        const activeUsers = JSON.parse(message.body);
        updateActiveUsersList(activeUsers);
      });
    }, function (error) {
      console.error('WebSocket error: ', error);
      document.getElementById('connectionStatus').textContent = 'Disconnected';
      document.getElementById('connectionStatus').className = 'badge bg-danger';
    });

    // Function to update the active users list in the UI
    function updateActiveUsersList(users) {
      const listElement = document.getElementById('activeUsersList');
      listElement.innerHTML = '';
      if (users.length === 0) {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = 'KhÃ´ng cÃ³ ngÆ°á»i dÃ¹ng nÃ o Ä‘ang online';
        listElement.appendChild(li);
      } else {
        users.forEach(user => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.textContent = user;
          listElement.appendChild(li);
        });
      }
    }
  </script>
</div>

</body>
</html>
