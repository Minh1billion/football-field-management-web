<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/user :: layout(~{::content})}">
<head>
  <meta charset="UTF-8">
  <title>Giỏ Hàng Thuê Đồ Của Bạn</title>
</head>
<body>
<div th:fragment="content">
  <div class="container mt-5 mb-5">
    <h2 class="mb-4">
      <i class="bi bi-cart-fill text-primary"></i> Giỏ Hàng Thuê Đồ
    </h2>

    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="bi bi-check-circle"></i> <span th:text="${successMessage}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-circle"></i> <span th:text="${errorMessage}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${cartDTO != null and #lists.isEmpty(cartDTO.items) == false}">
      <div class="row">
        <div class="col-lg-8">
          <div class="card shadow-sm border-0">
            <div class="card-body p-0">
              <!-- Form cập nhật -->
              <form th:action="@{/user/rentals/update-cart}" method="post">
                <table class="table table-hover align-middle mb-0">
                  <thead class="table-light">
                  <tr>
                    <th>Sản Phẩm</th>
                    <th class="text-center">SL</th>
                    <th class="text-center">Ngày Thuê</th>
                    <th class="text-end">Đơn giá/ngày</th>
                    <th class="text-end">Thành tiền</th>
                    <th></th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr th:each="item,iterStat : ${cartDTO.items}">
                    <td>
                      <h6 th:text="${item.name}"></h6>
                      <input type="hidden" name="sportWearId" th:value="${item.sportWearId}" />
                    </td>
                    <td class="text-center">
                      <input type="number" name="quantity" th:value="${item.quantity}" min="1" class="form-control form-control-sm"/>
                    </td>
                    <td class="text-center">
                      <input type="number" name="rentalDays" th:value="${item.rentalDays}" min="1" class="form-control form-control-sm"/>
                    </td>
                    <td class="text-end text-success fw-bold" th:text="${#numbers.formatDecimal(item.rentalPricePerDay,0,'POINT',0,'COMMA')}+'₫'"></td>
                    <td class="text-end fw-bold" th:text="${#numbers.formatDecimal(item.rentalPricePerDay * item.quantity * item.rentalDays,0,'POINT',0,'COMMA')}+'₫'"></td>
                    <td>
                      <!-- Link xóa thay vì form -->
                      <a th:href="@{/user/rentals/remove/{id}(id=${item.sportWearId})}"
                         class="btn btn-sm btn-outline-danger"
                         onclick="return confirm('Bạn có chắc muốn xóa sản phẩm này?')">
                        <i class="bi bi-trash"></i> Xóa
                      </a>
                    </td>
                  </tr>
                  </tbody>
                </table>
                <div class="text-end mt-3 p-3">
                  <button type="submit" class="btn btn-warning">
                    <i class="bi bi-arrow-repeat"></i> Cập nhật giỏ hàng
                  </button>
                </div>
              </form>
            </div>
          </div>

          <a th:href="@{/user/rentals}" class="btn btn-outline-secondary mt-3">
            <i class="bi bi-arrow-left"></i> Tiếp tục thuê
          </a>
        </div>

        <div class="col-lg-4">
          <div class="card shadow-sm border-primary">
            <div class="card-body">
              <h5 class="card-title text-primary">Tóm Tắt Đơn Hàng</h5>
              <hr>
              <div class="d-flex justify-content-between mb-2 fs-5">
                <span>Tổng tiền thuê:</span>
                <span class="fw-bold text-danger">
                    <span th:text="${#numbers.formatDecimal(cartDTO.totalPrice, 0, 'POINT', 0, 'COMMA')}">900.000</span>₫
                </span>
              </div>
              <small class="text-muted d-block mb-3">Tổng tiền này chưa bao gồm phí vận chuyển và phụ phí khác (nếu có).</small>

              <a th:href="@{/user/rentals/checkout}" class="btn btn-success w-100 btn-lg">
                <i class="bi bi-credit-card-2-front me-2"></i> Tiến hành Thanh Toán
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div th:if="${cartDTO != null and #lists.isEmpty(cartDTO.items)}" class="text-center py-5 border rounded bg-light mt-5">
      <i class="bi bi-emoji-frown fs-1 text-secondary"></i>
      <p class="mt-3 fs-5">Giỏ hàng thuê của bạn đang trống.</p>
      <a th:href="@{/user/rentals}" class="btn btn-primary mt-2">
        Bắt đầu thuê ngay
      </a>
    </div>
  </div>
</div>
</body>
</html>