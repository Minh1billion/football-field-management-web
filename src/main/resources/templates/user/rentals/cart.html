<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/user :: layout(~{::content})}">
<head>
  <meta charset="UTF-8">
  <title>Giỏ Hàng Thuê Đồ Của Bạn</title>
</head>
<body>
<div th:fragment="content">
  <div class="container mt-5 mb-5">
    <h2 class="mb-4">
      <i class="bi bi-cart-fill text-primary"></i> Giỏ Hàng Thuê Đồ
    </h2>

    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="bi bi-check-circle"></i> <span th:text="${successMessage}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-circle"></i> <span th:text="${errorMessage}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${cartDTO != null and #lists.isEmpty(cartDTO.items) == false}">
      <div class="row">
        <div class="col-lg-8">
          <div class="card shadow-sm border-0">
            <div class="card-body p-0">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                <tr>
                  <th scope="col">Sản Phẩm</th>
                  <th scope="col" class="text-center">SL</th>
                  <th scope="col" class="text-center">Ngày Thuê</th>
                  <th scope="col" class="text-end">Đơn giá/ngày</th>
                  <th scope="col" class="text-end">Thành tiền</th>
                  <th scope="col"></th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${cartDTO.items}">
                  <td>
                    <h6 class="mb-0" th:text="${item.name}"></h6>
                    <small class="text-muted">ID: <span th:text="${item.sportWearId}"></span></small>
                  </td>

                  <td class="text-center">
                    <input type="number"
                           th:value="${item.quantity}"
                           min="1"
                           class="form-control form-control-sm text-center"
                           style="width: 70px; display: inline-block;">
                  </td>

                  <td class="text-center">
                    <input type="number"
                           th:value="${item.rentalDays}"
                           min="1"
                           class="form-control form-control-sm text-center"
                           style="width: 70px; display: inline-block;">
                  </td>

                  <td class="text-end text-success fw-bold">
                    <span th:text="${#numbers.formatDecimal(item.rentalPricePerDay, 0, 'POINT', 0, 'COMMA')}">100.000</span>₫
                  </td>

                  <td class="text-end fw-bold">
                    <span th:with="subtotal=${item.rentalPricePerDay.multiply(T(java.math.BigDecimal).valueOf(item.quantity.longValue())).multiply(T(java.math.BigDecimal).valueOf(item.rentalDays.longValue()))}">
                        <span th:text="${#numbers.formatDecimal(subtotal, 0, 'POINT', 0, 'COMMA')}">300.000</span>₫
                    </span>
                  </td>

                  <td>
                    <form th:action="@{/user/rentals/remove/{id}(id=${item.sportWearId})}" method="post">
                      <button type="submit" class="btn btn-sm btn-outline-danger" title="Xóa khỏi giỏ">
                        <i class="bi bi-trash"></i>
                      </button>
                    </form>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>

          <a th:href="@{/user/rentals}" class="btn btn-outline-secondary mt-3">
            <i class="bi bi-arrow-left"></i> Tiếp tục thuê
          </a>
        </div>

        <div class="col-lg-4">
          <div class="card shadow-sm border-primary">
            <div class="card-body">
              <h5 class="card-title text-primary">Tóm Tắt Đơn Hàng</h5>
              <hr>
              <div class="d-flex justify-content-between mb-2 fs-5">
                <span>Tổng tiền thuê:</span>
                <span class="fw-bold text-danger">
                    <span th:text="${#numbers.formatDecimal(cartDTO.totalPrice, 0, 'POINT', 0, 'COMMA')}">900.000</span>₫
                </span>
              </div>
              <small class="text-muted d-block mb-3">Tổng tiền này chưa bao gồm phí vận chuyển và phụ phí khác (nếu có).</small>

              <a th:href="@{/user/rentals/checkout}" class="btn btn-success w-100 btn-lg">
                <i class="bi bi-credit-card-2-front me-2"></i> Tiến hành Thanh Toán
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div th:if="${cartDTO != null and #lists.isEmpty(cartDTO.items)}" class="text-center py-5 border rounded bg-light mt-5">
      <i class="bi bi-emoji-frown fs-1 text-secondary"></i>
      <p class="mt-3 fs-5">Giỏ hàng thuê của bạn đang trống.</p>
      <a th:href="@{/user/rentals}" class="btn btn-primary mt-2">
        Bắt đầu thuê ngay
      </a>
    </div>
  </div>
</div>
</body>
</html>