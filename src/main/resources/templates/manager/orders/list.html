<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/manager :: layout(~{::content})}">
<head>
  <title>Quản lý đơn hàng</title>
</head>
<body>
<div th:fragment="content">
  <div class="container-fluid py-4">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header pb-0">
            <div class="d-flex justify-content-between align-items-center">
              <h5>Quản lý đơn hàng</h5>
            </div>
          </div>

          <!-- Filters -->
          <div class="card-body pb-2">
            <form method="get" th:action="@{/manager/orders}" class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Loại đơn</label>
                <select name="type" class="form-select" onchange="this.form.submit()">
                  <option value="all" th:selected="${type == 'all'}">Tất cả</option>
                  <option value="sale" th:selected="${type == 'sale'}">Đơn mua</option>
                  <option value="rental" th:selected="${type == 'rental'}">Đơn thuê</option>
                  <option value="booking" th:selected="${type == 'booking'}">Booking sân</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Trạng thái</label>
                <select name="status" class="form-select" onchange="this.form.submit()">
                  <option value="all" th:selected="${status == 'all'}">Tất cả</option>
                  <option value="pending" th:selected="${status == 'pending'}">Chờ xử lý</option>
                  <option value="confirmed" th:selected="${status == 'confirmed'}">Đã xác nhận</option>
                  <option value="completed" th:selected="${status == 'completed'}">Hoàn thành</option>
                  <option value="cancelled" th:selected="${status == 'cancelled'}">Đã hủy</option>
                </select>
              </div>
            </form>
          </div>

          <!-- Alert messages -->
          <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show mx-4" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
          <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show mx-4" role="alert">
            <span th:text="${errorMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>

          <!-- Orders table -->
          <div class="card-body pt-0">
            <div class="table-responsive">
              <table class="table table-hover align-items-center mb-0">
                <thead>
                <tr>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Mã đơn</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Loại</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Khách hàng</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Tổng tiền</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Trạng thái đơn</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Thanh toán</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Trả đồ</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Ngày tạo</th>
                  <th class="text-uppercase text-secondary text-xxs font-weight-bolder">Thao tác</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="order : ${orders}">
                  <td>
                    <span class="text-sm font-weight-bold" th:text="${order.code}"></span>
                  </td>
                  <td>
                    <span th:if="${order.type == 'SALE'}" class="badge badge-sm bg-info">Đơn mua</span>
                    <span th:if="${order.type == 'RENTAL'}" class="badge badge-sm bg-warning text-dark">Đơn thuê</span>
                    <span th:if="${order.type == 'BOOKING'}" class="badge badge-sm bg-primary">Booking</span>
                  </td>
                  <td>
                    <span class="text-sm" th:text="${order.customerName}"></span>
                  </td>
                  <td>
                    <span class="text-sm font-weight-bold"
                          th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' đ'"></span>
                  </td>
                  <td>
                    <span th:if="${order.status == 'PENDING'}" class="badge badge-sm bg-warning text-dark" th:text="${order.status}"></span>
                    <span th:if="${order.status == 'PROCESSING'}" class="badge badge-sm bg-info" th:text="${order.status}"></span>
                    <span th:if="${order.status == 'CONFIRMED'}" class="badge badge-sm bg-info" th:text="${order.status}"></span>
                    <span th:if="${order.status == 'READY'}" class="badge badge-sm bg-primary" th:text="${order.status}"></span>
                    <span th:if="${order.status == 'SHIPPING'}" class="badge badge-sm bg-info" th:text="${order.status}"></span>
                    <span th:if="${order.status == 'DELIVERED'}" class="badge badge-sm bg-success" th:text="${order.status}"></span>
                    <span th:if="${order.status == 'COMPLETED'}" class="badge badge-sm bg-success" th:text="${order.status}"></span>
                    <span th:if="${order.status == 'CANCELLED'}" class="badge badge-sm bg-secondary" th:text="${order.status}"></span>
                    <span th:if="${order.status == 'ACTIVE'}" class="badge badge-sm bg-primary" th:text="${order.status}"></span>
                  </td>
                  <td>
                    <div class="d-flex flex-column">
                      <span th:if="${order.paymentStatus == 'PENDING'}" class="badge badge-sm bg-warning text-dark mb-1" th:text="${order.paymentStatus}"></span>
                      <span th:if="${order.paymentStatus == 'COMPLETED'}" class="badge badge-sm bg-success mb-1" th:text="${order.paymentStatus}"></span>
                      <span th:if="${order.paymentStatus == 'FAILED'}" class="badge badge-sm bg-danger mb-1" th:text="${order.paymentStatus}"></span>
                      <span th:if="${order.paymentStatus == 'N/A'}" class="badge badge-sm bg-secondary mb-1" th:text="${order.paymentStatus}"></span>
                      <small class="text-xs text-secondary" th:text="${order.paymentMethod}"></small>
                    </div>
                  </td>
                  <td>
                    <span th:if="${order.type == 'SALE'}" class="text-xs text-secondary">N/A</span>
                    <span th:unless="${order.type == 'SALE'}">
                      <span th:if="${order.allReturned}" class="badge badge-sm bg-success">Đã trả</span>
                      <span th:unless="${order.allReturned}" class="badge badge-sm bg-warning text-dark">Chưa trả</span>
                    </span>
                  </td>
                  <td>
                    <span class="text-xs"
                          th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                  </td>
                  <td>
                    <a th:if="${order.type == 'SALE'}"
                       th:href="@{/manager/orders/sale/{id}(id=${order.id})}"
                       class="btn btn-link text-primary px-2 mb-0">
                      <i class="fas fa-eye text-xs"></i> Xem
                    </a>
                    <a th:if="${order.type == 'RENTAL'}"
                       th:href="@{/manager/orders/rental/{id}(id=${order.id})}"
                       class="btn btn-link text-primary px-2 mb-0">
                      <i class="fas fa-eye text-xs"></i> Xem
                    </a>
                    <a th:if="${order.type == 'BOOKING'}"
                       th:href="@{/manager/orders/booking/{id}(id=${order.id})}"
                       class="btn btn-link text-primary px-2 mb-0">
                      <i class="fas fa-eye text-xs"></i> Xem
                    </a>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>

            <div th:if="${#lists.isEmpty(orders)}" class="text-center py-5">
              <p class="text-secondary mb-0">Không có đơn hàng nào</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>