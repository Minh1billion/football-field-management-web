<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/user :: layout(~{::content})}">
<body>
<div th:fragment="content" class="container mt-4">
    <h3>üîç Chi ti·∫øt ƒë·∫∑t s√¢n</h3>

    <!-- Th√¥ng b√°o -->
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle"></i> <span th:text="${successMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-circle"></i> <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${booking}">
        <div class="card mb-3">
            <div class="card-body">
                <p><strong>M√£ ƒë·∫∑t:</strong> <span th:text="${booking.bookingCode}"></span></p>
                <p><strong>T√™n s√¢n:</strong> <span th:text="${booking.fieldName}"></span></p>
                <p><strong>Ng√†y ƒë·∫∑t:</strong> <span th:text="${#temporals.format(booking.bookingTime, 'dd/MM/yyyy')}"></span></p>
                <p><strong>Th·ªùi gian:</strong>
                    <span th:text="${#temporals.format(booking.startTime, 'HH:mm')}"></span> -
                    <span th:text="${#temporals.format(booking.endTime, 'HH:mm')}"></span>
                </p>
                <p><strong>T·ªïng ti·ªÅn:</strong>
                    <span th:text="${#numbers.formatDecimal(booking.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></span>
                </p>
                <p><strong>Tr·∫°ng th√°i:</strong>
                    <span th:if="${booking.status == 'PENDING'}" class="badge bg-warning text-dark">Ch·ªù x√°c nh·∫≠n</span>
                    <span th:if="${booking.status == 'CONFIRMED'}" class="badge bg-info">ƒê√£ x√°c nh·∫≠n</span>
                    <span th:if="${booking.status == 'COMPLETED'}" class="badge bg-success">Ho√†n th√†nh</span>
                    <span th:if="${booking.status == 'CANCELLED'}" class="badge bg-secondary">ƒê√£ h·ªßy</span>
                </p>
                <p><strong>Thanh to√°n:</strong> <span th:text="${booking.paymentMethod}"></span></p>

                <div th:if="${booking.notes != null and !booking.notes.isEmpty()}" class="mt-3">
                    <strong>Ghi ch√∫:</strong>
                    <p class="text-muted" th:text="${booking.notes}"></p>
                </div>
            </div>
        </div>

        <!-- ƒê·ªì th·ªÉ thao ƒë√£ thu√™ -->
        <div class="card mb-3" th:if="${booking.sportWears != null and !booking.sportWears.isEmpty()}">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">üëï ƒê·ªì th·ªÉ thao ƒë√£ thu√™</h5>
                <span th:if="${booking.status == 'PENDING'}" class="badge bg-light text-dark">
                    <i class="bi bi-info-circle"></i> C√≥ th·ªÉ ch·ªânh s·ª≠a
                </span>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>T√™n s·∫£n ph·∫©m</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>S·ªë ng√†y thu√™</th>
                        <th>ƒê∆°n gi√°</th>
                        <th>Th√†nh ti·ªÅn</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th th:if="${booking.status == 'PENDING'}">Thao t√°c</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="item : ${booking.sportWears}">
                        <td th:text="${item.name}"></td>
                        <td th:text="${item.quantity}"></td>
                        <td th:text="${item.rentalDays}"></td>
                        <td th:text="${#numbers.formatDecimal(item.rentalPricePerDay, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
                        <td th:text="${#numbers.formatDecimal(item.totalPrice, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
                        <td>
                            <span th:text="${item.status}"></span>
                        </td>

                        <!-- C·ªôt Thao t√°c -->
                        <td th:if="${booking.status == 'PENDING'}">
                            <form th:action="@{'/user/bookings/' + ${booking.id} + '/remove-sportwear/' + ${item.sportWearId}}"
                                  method="post"
                                  onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë·ªì thu√™ n√†y kh√¥ng?');">
                                <button type="submit" class="btn btn-sm btn-danger">
                                    <i class="bi bi-trash"></i> X√≥a
                                </button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Th√¥ng b√°o n·∫øu ch∆∞a c√≥ ƒë·ªì thu√™ -->
        <div class="alert alert-info" th:if="${booking.sportWears == null or booking.sportWears.isEmpty()}">
            Ch∆∞a c√≥ ƒë·ªì th·ªÉ thao n√†o ƒë∆∞·ª£c thu√™ cho booking n√†y.
        </div>

        <!-- D·ªãch v·ª• ƒë√£ ƒë·∫∑t -->
        <div class="card mb-3" th:if="${booking.services != null and !booking.services.isEmpty()}">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">‚öôÔ∏è D·ªãch v·ª• ƒë√£ ƒë·∫∑t</h5>
            </div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>T√™n d·ªãch v·ª•</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>ƒê∆°n gi√°</th>
                        <th>Th√†nh ti·ªÅn</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="item : ${booking.services}">
                        <td th:text="${item.name}"></td>
                        <td th:text="${item.quantity}"></td>
                        <td th:text="${#numbers.formatDecimal(item.rentalPricePerDay, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
                        <td th:text="${#numbers.formatDecimal(item.totalPrice, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Th√¥ng b√°o n·∫øu ch∆∞a c√≥ d·ªãch v·ª• -->
        <div class="alert alert-info" th:if="${booking.services == null or booking.services.isEmpty()}">
            Ch∆∞a c√≥ d·ªãch v·ª• n√†o ƒë∆∞·ª£c ƒë·∫∑t cho booking n√†y.
        </div>
    </div>

    <!-- N√∫t h√†nh ƒë·ªông -->
    <div class="mt-3 d-flex gap-2">
        <a th:href="@{/user/bookings}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Quay l·∫°i danh s√°ch
        </a>

        <!-- N√∫t Edit (ch·ªâ hi·ªán khi status = PENDING ho·∫∑c CONFIRMED) -->
        <a th:if="${booking.status == 'PENDING' or booking.status == 'CONFIRMED'}"
           th:href="@{'/user/bookings/' + ${booking.id} + '/edit'}"
           class="btn btn-warning">
            <i class="bi bi-pencil"></i> Ch·ªânh s·ª≠a
        </a>

        <!-- N√∫t th√™m ƒë·ªì thu√™ ch·ªâ hi·ªán khi PENDING -->
        <a th:if="${booking.status == 'PENDING'}"
           th:href="@{/user/rentals}"
           class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Th√™m ƒë·ªì thu√™
        </a>

        <div th:if="${booking.status == 'COMPLETED'}" class="mt-3">
            <a th:href="@{/user/reviews/new(bookingId=${booking.id})}"
               class="btn btn-warning">
                <i class="bi bi-star"></i> ƒê√°nh Gi√° S√¢n
            </a>
        </div>
    </div>
</div>
</body>
</html>