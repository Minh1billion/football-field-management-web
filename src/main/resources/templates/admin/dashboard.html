<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/admin :: layout(~{::content})}">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
</head>
<body>
<div th:fragment="content">
  <h2 class="mb-4">📊 Tổng quan hệ thống</h2>
  <div class="row text-center mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-primary text-white">
        <div class="card-body">
          <h5 class="card-title">👥 Tổng tài khoản</h5>
          <h2 th:text="${totalAccounts ?: 0}">0</h2>
          <small>Tất cả tài khoản trong hệ thống</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-success text-white">
        <div class="card-body">
          <h5 class="card-title">👤 Người dùng</h5>
          <h2 th:text="${totalUsers ?: 0}">0</h2>
          <small>Tài khoản USER</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-warning text-white">
        <div class="card-body">
          <h5 class="card-title">👨‍💼 Quản lý</h5>
          <h2 th:text="${totalManagers ?: 0}">0</h2>
          <small>Tài khoản MANAGER</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-danger text-white">
        <div class="card-body">
          <h5 class="card-title">👑 Quản trị</h5>
          <h2 th:text="${totalAdmins ?: 0}">0</h2>
          <small>Tài khoản ADMIN</small>
        </div>
      </div>
    </div>
  </div>
  <div class="row text-center mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-info text-white">
        <div class="card-body">
          <h5 class="card-title">🏟️ Sân hoạt động</h5>
          <h2 th:text="${totalFields ?: 0}">0</h2>
          <small>Sân đang mở</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-secondary text-white">
        <div class="card-body">
          <h5 class="card-title">🏢 Tổng dịch vụ</h5>
          <h2 th:text="${totalServices ?: 0}">0</h2>
          <small>Tất cả dịch vụ</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-success text-white">
        <div class="card-body">
          <h5 class="card-title">✅ TK hoạt động</h5>
          <h2 th:text="${activeAccounts ?: 0}">0</h2>
          <small>Tài khoản đang hoạt động</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm border-0 bg-dark text-white">
        <div class="card-body">
          <h5 class="card-title">❌ TK bị khóa</h5>
          <h2 th:text="${inactiveAccounts ?: 0}">0</h2>
          <small>Tài khoản bị vô hiệu hóa</small>
        </div>
      </div>
    </div>
  </div>
  <!-- Section to display active users -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title">👥 Người dùng đang online <span id="connectionStatus" class="badge bg-danger">Disconnected</span></h5>
          <ul id="activeUsersList" class="list-group"></ul>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize WebSocket connection
    const socket = new SockJS('/ws');
    const stompClient = Stomp.over(socket);

    // Connect to WebSocket (no username needed for admin dashboard)
    stompClient.connect({}, function (frame) {
      console.log('Connected: ' + frame);
      document.getElementById('connectionStatus').textContent = 'Connected';
      document.getElementById('connectionStatus').className = 'badge bg-success';

      // Subscribe to /topic/activeUsers
      stompClient.subscribe('/topic/activeUsers', function (message) {
        const activeUsers = JSON.parse(message.body);
        updateActiveUsersList(activeUsers);
      });
    }, function (error) {
      console.error('WebSocket error: ', error);
      document.getElementById('connectionStatus').textContent = 'Disconnected';
      document.getElementById('connectionStatus').className = 'badge bg-danger';
    });

    // Function to update the active users list in the UI
    function updateActiveUsersList(users) {
      const listElement = document.getElementById('activeUsersList');
      listElement.innerHTML = '';
      if (users.length === 0) {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = 'Không có người dùng nào đang online';
        listElement.appendChild(li);
      } else {
        users.forEach(user => {
          const li = document.createElement('li');
          li.className = 'list-group-item';
          li.textContent = user;
          listElement.appendChild(li);
        });
      }
    }
  </script>
</div>

</body>
</html>
