<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/user :: layout(~{::content})}">
<head>
    <meta charset="UTF-8">
    <title>Danh sách thanh toán</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
<div th:fragment="content" class="container my-4">

    <h3 class="text-center text-primary mb-4">Danh sách thanh toán</h3>

    <!-- Alert messages -->
    <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <span th:if="${param.error[0] == 'payment_not_found'}">Không tìm thấy thông tin thanh toán!</span>
        <span th:if="${param.error[0] == 'invalid_payment_status'}">Đơn hàng không hợp lệ để thanh toán!</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered table-hover text-center align-middle">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Mã thanh toán</th>
                <th>Số tiền</th>
                <th>Phương thức</th>
                <th>Trạng thái</th>
                <th>Booking ID</th>
                <th>Order ID</th>
                <th>RentalOrder ID</th>
                <th>Ngày thanh toán</th>
                <th>Ngày tạo</th>
                <th>Ghi chú</th>
                <th>Thao tác</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="p : ${orders}">
                <td th:text="${p.id}">1</td>
                <td th:text="${p.paymentCode}">PM001</td>
                <td th:text="${#numbers.formatDecimal(p.amount, 0, 'COMMA', 0, 'POINT')} + ' ₫'">100,000 ₫</td>
                <td th:text="${p.paymentMethod}">VNPAY</td>
                <td>
                    <span th:text="${p.status}"
                          th:classappend="${p.status == 'COMPLETED'} ? 'badge bg-success' :
                                          (p.status == 'PENDING' ? 'badge bg-warning text-dark' :
                                          'badge bg-danger')"></span>
                </td>
                <td th:text="${p.bookingId != null ? p.bookingId : '-'}"></td>
                <td th:text="${p.orderId != null ? p.orderId : '-'}"></td>
                <td th:text="${p.rentalOrderId != null ? p.rentalOrderId : '-'}"></td>
                <td th:text="${p.paidAt != null ? #temporals.format(p.paidAt, 'dd/MM/yyyy HH:mm') : '-'}"></td>
                <td th:text="${p.createdAt != null ? #temporals.format(p.createdAt, 'dd/MM/yyyy HH:mm') : '-'}"></td>
                <td th:text="${p.notes != null ? p.notes : '-'}"></td>
                <td>
                    <!-- Hiển thị nút thanh toán nếu là VNPAY và trạng thái PENDING -->
                    <a th:if="${p.paymentMethod == 'VNPAY' && p.status == 'PENDING'}"
                       th:href="@{/user/orders/payment/{id}(id=${p.id})}"
                       class="btn btn-primary btn-sm">
                        <i class="bi bi-credit-card"></i> Thanh toán
                    </a>
                    <span th:unless="${p.paymentMethod == 'VNPAY' && p.status == 'PENDING'}"
                          class="text-muted">-</span>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(orders)}">
                <td colspan="12" class="text-muted fst-italic">Không có dữ liệu thanh toán</td>
            </tr>
            </tbody>
        </table>
    </div>

</div>
</body>
</html>