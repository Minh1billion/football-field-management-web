<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lịch bảo trì</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{manager/fragments/navbar :: navbar}"></div>
<div class="container">
    <h3 class="mb-3">Lịch bảo trì</h3>

    <form class="row g-2 mb-4" method="post" action="/manager/maintenances/schedule">
        <div class="col-md-2">
            <label class="form-label">Sân</label>
            <select class="form-select" name="fieldId" required>
                <option th:each="f : ${fields}" th:value="${f.id}" th:text="${f.name}"></option>
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Loại</label>
            <select class="form-select" name="type" required>
                <option th:each="t : ${types}" th:value="${t}" th:text="${t}"></option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">Thời điểm</label>
            <input type="datetime-local" class="form-control" name="scheduledDate" required>
        </div>
        <div class="col-md-3">
            <label class="form-label">Tiêu đề</label>
            <input class="form-control" name="title" required>
        </div>
        <div class="col-md-2 align-self-end">
            <button class="btn btn-primary w-100">Lên lịch</button>
        </div>
        <div class="col-12">
            <input class="form-control" name="description" placeholder="Mô tả (tuỳ chọn)">
        </div>
    </form>

    <table class="table table-bordered">
        <thead><tr><th>Sân</th><th>Tiêu đề</th><th>Loại</th><th>Thời điểm</th><th>Trạng thái</th><th>Thao tác</th></tr></thead>
        <tbody>
        <tr th:each="m : ${maintenances}">
            <td th:text="${m.field.name}"></td>
            <td th:text="${m.title}"></td>
            <td th:text="${m.type}"></td>
            <td th:text="${#dates.format(m.scheduledDate, 'yyyy-MM-dd HH:mm')}"></td>
            <td th:text="${m.status}"></td>
            <td>
                <form th:action="@{'/manager/maintenances/' + ${m.id} + '/status'}" method="post" class="d-inline">
                    <select name="status" class="form-select form-select-sm d-inline w-auto">
                        <option th:each="s : ${statuses}" th:value="${s}" th:text="${s}" th:selected="${m.status} == ${s}"></option>
                    </select>
                    <button class="btn btn-sm btn-success">Cập nhật</button>
                </form>
                <form th:action="@{'/manager/maintenances/' + ${m.id} + '/delete'}" method="post" class="d-inline">
                    <button class="btn btn-sm btn-danger" onclick="return confirm('Xoá lịch?')">Xoá</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>